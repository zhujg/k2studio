#{extends 'layout.html'/}

#{set 'moreScripts'}
<script type="text/javascript">
$(function(){
	$('#t-menus').tree({
		onClick:function(){
			normalQuery();
		}
	});
	
	$('#list').datagrid({
		nowrap: false,
		striped: true,
		collapsible:true,
		singleSelect:true,
		url:'@{getItems()}',
		sortName: 'code',
		sortOrder: 'desc',
		remoteSort: false,
		idField:'id',
		columns:[[
			{field:'name',title:'菜单名称',width:120},
			{field:'url',title:'请求路径',width:250},
			{field:'pid',title:'上级菜单',width:100},
			{field:'sort',title:'排序号',width:80},
			{field:'icon',title:'节点图片CSS类名',width:100}
		]],
		pagination:true,
		rownumbers:true,
		toolbar:[
			{id:'btnadd',text:'新增',iconCls:'icon-add',handler:function(){newItem();}},
		    {id:'btnedit',text:'修改',iconCls:'icon-edit'},
		    {id:'btndel',text:'删除',iconCls:'icon-remove',handler:function(){delItem();}}
		]
	})
});

function normalQuery(value){
	var node = $('#t-menus').tree('getSelected');
	$('#list').datagrid('load',{
		pid: (node?node.id:0),
		q: value
	});
}

var url;
function newItem(){
	$('#dlg').dialog('setTitle','新增菜单').dialog('open');
	$('#myform').form('clear');
	url = "@{save()}";
}

function saveItem(){
	$('#myform').form('submit',{
		url:url,
		onSubmit:function(){return $(this).form('validate');},
		success:function(){
			$('#dlg').dialog('close');
			$('#list').datagrid('reload');
			$('#t-menus').tree('reload');
		}
	});
}

function delItem(){
	var row = $('#list').datagrid('getSelected');
	if (row){
		$.messager.confirm({
			title: "请确认",
			msg: "您真的要删除该数据?",
			fn:function(){
				alert(1);
			}
		});
		return;
	}
}
</script>
#{/set}


<div region="west" iconCls="icon-ok" split="true" title="功能菜单" style="width:250px;">
<ul id="t-menus" url="/Menus/getTree"></ul>
</div>
		
<div region="center" title="菜单信息表" style="padding:5px;">
<table id="list" fit="true"></table>
</div>

<div id="dlg" class="easyui-dialog" style="width:320px;height:250px;" closed="true" modal="true" buttons="#dlg-buttons">
<form id="myform" method="post">
#{include 'Menus/_form.html'/}
</form>
<div id="dlg-buttons" style="text-align:center">
<a href="#" class="easyui-linkbutton" iconCls="icon-save" onclick="saveItem()">保存</a>
<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">取消</a>
</div>
</div>